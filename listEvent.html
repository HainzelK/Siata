<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/styleCard.css">
    <link rel="stylesheet" href="css/styleNav.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>List Event</title>
    <style>
        body {
            overflow-x: hidden;
        }

        ::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body>
    <nav>
        <a href="#" class="logo"> <p>Logo</p>
          <svg>
              <!-- logo  -->
          </svg>
        </a>
        <ul class="nav">
          <li><a href="#" class="link">Home</a></li>
          <li><a href="kalender" class="link">Kalender</a></li>
          <li><a href="#" class="link">Event</a></li>
          <li><a href="#" class="link profile-link" style="display: none;">Profile</a></li>
        </ul>
        <button class="menu-icon" aria-label="Menu">
          <svg fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 6H20M4 12H20M13 18H20" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" />
          </svg>
        </button>
        <button class="tombol-login">Login/Signup</button>
    </nav>
    <section>
        <div class="kontener">
            <h1 class="hasatu">List Kegiatan Kami</h1>
            <div class="row container-card" id="card-container">
                <!-- Card contents will be injected here -->
            </div>
        </div>
    </section>
    <footer class="footer">
        <div class="container-footer row-footer custom-row">
            <div class="footer-col">
                <h4>Company</h4>
                <ul>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Sesuatu 2</a></li>
                    <li><a href="#">Sesuatu 3</a></li>
                    <li><a href="#">Sesuatu 4</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4>Text</h4>
                <ul>
                    <li><a href="#">Sesuatu 1</a></li>
                    <li><a href="#">Sesuatu 2</a></li>
                    <li><a href="#">Sesuatu 3</a></li>
                    <li><a href="#">Sesuatu 4</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4>Text 2</h4>
                <ul>
                    <li><a href="#">Sesuatu 1</a></li>
                    <li><a href="#">Sesuatu 2</a></li>
                    <li><a href="#">Sesuatu 3</a></li>
                    <li><a href="#">Sesuatu 4</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4>Follow</h4>
                <div class="social-links">
                    <a href="#"><i class="fa-brands fa-facebook-f"></i></a>
                    <a href="#"><i class="fa-brands fa-facebook-f"></i></a>
                    <a href="#"><i class="fa-brands fa-facebook-f"></i></a>
                    <a href="#"><i class="fa-brands fa-facebook-f"></i></a>
                </div>
            </div>
        </div>
    </footer>
    <script src="script.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Fetch initial data from the backend when the page loads
            fetchData();

            // Check if the user is logged in
            checkLoginStatus();
        });

        function getCookie(name) {
            let cookieArr = document.cookie.split(";");
            for (let i = 0; i < cookieArr.length; i++) {
                let cookiePair = cookieArr[i].split("=");
                if (name === cookiePair[0].trim()) {
                    return decodeURIComponent(cookiePair[1]);
                }
            }
            return null;
        }

        function extractEmailFromToken(token) {
            try {
                const tokenPayload = token.split('.')[1];
                const decodedPayload = atob(tokenPayload);
                const payloadObject = JSON.parse(decodedPayload);
                const email = payloadObject.sub;
                return email;
            } catch (error) {
                console.error('Error extracting email from JWT token:', error);
                return null;
            }
        }

        async function checkLoginStatus() {
            const token = getCookie('token');
            const loginSignupButton = document.querySelector('.tombol-login');
            const profileLink = document.querySelector('.profile-link');

            if (token) {
                try {
                    const email = extractEmailFromToken(token);
                    if (email) {
                        // User is logged in
                        loginSignupButton.style.display = 'none';
                        profileLink.style.display = 'inline';
                    } else {
                        // Token is invalid
                        loginSignupButton.style.display = 'inline';
                        profileLink.style.display = 'none';
                    }
                } catch (error) {
                    console.error('Error checking login status:', error);
                    loginSignupButton.style.display = 'inline';
                    profileLink.style.display = 'none';
                }
            } else {
                // No token found, user is not logged in
                loginSignupButton.style.display = 'inline';
                profileLink.style.display = 'none';
            }
        }
    </script>
</body>
</html>
